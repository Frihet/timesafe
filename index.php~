<?php



function htmlEncode($str) 
{
    return htmlEntities($str, ENT_QUOTES, 'UTF-8');
    
}

function param($name, $default=null) 
{
    if(array_key_exists($name, $_REQUEST)) {
        return $_REQUEST[$name];
    }
    return $default;
}

class project
{
    function getProjects()
    {
        return array('Div7 - Executive', 
                     'Div1 - Admin',
                     'Div2 - Marketing and Sales',
                     'Div3 - Treasury',
                     'Div4 - Delivery',
                     'Div5 - Quality', 
                     'Div6 - Ideology', 
                     'Div4A:Doozerland',
                     'Div4G:Curriculum',
                     'Elkjøp:Greencycle',
                     'Elkjøp:ESC3',
                     'Elkjøp:ELOG',
                     'Elkjøp:Ecco',
                     'Elkjøp:Ecco Statistics module',
                     'Steen&Strøm:MAC police',
                     'Ericsson:TLA',
                     'ColorLine:NBI',
                     'RealTech:Support',
                     'Zamboni:Triumf');
    }

}



class form
{
    static $iframe_id=0;

    /**
     Create a select box with the specified values.
     */
    function makeSelect($name, $values, $selected=null, $id=null, $multiple=false, $sz=null) {
        $id_str = $id?'id="'.htmlEncode($id).'"':'';
		$sz_str=$sz?"size='$sz'":"";
		
        $multiple_str = $multiple?'multiple':'';
        $name_str = htmlEncode($name);
        $select = "<select $multiple_str name='$name_str' $id_str $sz_str>";
        
        if ($values!=null) {
            
            foreach($values as $id => $name) {
                $selected_str = "";
                
                if ($id == $selected) {
                    $selected_str = 'selected';
                }
                
                $select .= "<option $selected_str value='".htmlEncode($id)."'>". htmlEncode($name)."</option>\n";
            }
        }
        
        $select .= "</select>";
        return $select;
        
    }

}

function view()
{

        header('Content-Type: text/html; charset=utf-8');
        echo '
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
"http://www.w3.org/TR/html4/strict.dtd">
<html>
        <head>
                <meta http-equiv="Content-Type" content="text/html;charset=utf-8">
                <link rel="stylesheet" href="mockup1.css" type="text/css" media="screen,projection" />
                <link rel="stylesheet" type="text/css" href="calendar/dhtmlxcalendar.css">

                <script type="text/javascript" src="prototype.js"></script>
                <script type="text/javascript" src="mockup1.js"></script>
                <script type="text/javascript" src="tiny_mce/tiny_mce.js"></script>
                <script type="text/javascript" src="calendar/dhtmlxcommon.js"></script>
                <script type="text/javascript" src="calendar/dhtmlxcalendar.js"></script>
                <title>'.htmlEncode($title).'</title>
<script type="text/javascript">
tinyMCE.init({
mode : "specific_textareas",
editor_selector : "rich_edit",
theme : "simple"
});
     window.dhx_globalImgPath="calendar/imgs/";
</script>
        </head>
        <body>
';

        $calendar = "<input size='10' type='text' id='calendar_value' name='calendar' class='date' onchange='validate();'>
<div id='calendar'></div></div>
<script>
var mCal = new dhtmlxCalendarObject('calendar',true);
mCal.setSkin('classic');
mCal.options.weekstart=1
mCal.setDateFormat('%Y-%m-%d');
mCal.draw();
mCal.setOnClickHandler(function(date)
{
	$('calendar_value').value = mCal.getFormatedDate('%Y-%m-%d', date);
	return true;
});

</script>";
        $projects = form::makeSelect('project', project::getProjects(), null, 'project', true)."
<script>
$('project').onchange=function () {
makeTagSelect($('project'));
validate();
}
</script>
";

        $tags = form::makeSelect('tags', array(), null, 'tags', true, 32)."
<script>
$('tags').onchange=function () {
validate();
}
</script>
";
        $time = "<input id='time' name='time' onchange='validate()'>";   
        
        $description = "<textarea class='rich_edit' name='description' onchange='validate();'></textarea>";
        

    echo "
<form method='post'>
<div class='content'>
<div class='content_inner'>

<h1>Time registrator</h1>
<table>
<tr>
<th>Date</th>
<th>Project</th>
<th>Tags</th>
<th>Problems</th>
</tr><tr>
<td>$calendar</td>
<td rowspan='3'>$projects</td>
<td rowspan='5'>$tags</td>
<td rowspan='5'><div id='notification' class='messages'></div></td>

</tr><tr>
<th>Time</th>
</tr><tr>
<td>$time</td>
</tr><tr>
<th colspan='2'>Comment</th>
</tr><tr>
<td colspan='2'>
$description
</td>
</tr>
</table>

<button>Add</button>";
    
    require('fake_hours.php');
    

echo "

</div>
</div>
</form>
<script>
makeTagSelect($('project'));
validate();
</script>
";
  
  
    echo "
</body>
</html>";
    
    
}



function main()
{
    switch(param('action', 'view')) {
    case 'view':
        view();
    }
 
}


main();


?>